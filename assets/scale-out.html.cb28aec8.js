import{_ as c,o as r,c as i,b as a,a as n,w as t,d as s,e as u,r as p}from"./app.9dd76cc4.js";const d={},k=n("h1",{id:"\u8BA1\u7B97\u8282\u70B9\u6269\u7F29\u5BB9",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u8BA1\u7B97\u8282\u70B9\u6269\u7F29\u5BB9","aria-hidden":"true"},"#"),s(" \u8BA1\u7B97\u8282\u70B9\u6269\u7F29\u5BB9")],-1),_=n("p",null,"PolarDB for PostgreSQL \u662F\u4E00\u6B3E\u5B58\u50A8\u4E0E\u8BA1\u7B97\u5206\u79BB\u7684\u6570\u636E\u5E93\uFF0C\u6240\u6709\u8BA1\u7B97\u8282\u70B9\u5171\u4EAB\u5B58\u50A8\uFF0C\u5E76\u53EF\u4EE5\u6309\u9700\u8981\u5F39\u6027\u589E\u52A0\u6216\u5220\u51CF\u8BA1\u7B97\u8282\u70B9\u800C\u65E0\u9700\u505A\u4EFB\u4F55\u6570\u636E\u8FC1\u79FB\u3002\u6240\u6709\u672C\u6559\u7A0B\u5C06\u534F\u52A9\u60A8\u5728\u5171\u4EAB\u5B58\u50A8\u96C6\u7FA4\u4E0A\u6DFB\u52A0\u6216\u5220\u9664\u8BA1\u7B97\u8282\u70B9\u3002",-1),v={class:"table-of-contents"},b=s("\u90E8\u7F72\u8BFB\u5199\u8282\u70B9"),m=s("\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE"),h=s("\u683C\u5F0F\u5316\u5E76\u6302\u8F7D PFS \u6587\u4EF6\u7CFB\u7EDF"),g=s("\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55"),f=s("\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u914D\u7F6E"),y=s("\u542F\u52A8\u8BFB\u5199\u8282\u70B9"),x=s("\u96C6\u7FA4\u6269\u5BB9"),E=s("\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE"),M=s("\u6302\u8F7D PFS \u6587\u4EF6\u7CFB\u7EDF"),O=s("\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55"),$=s("\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u914D\u7F6E"),S=s("\u542F\u52A8\u53EA\u8BFB\u8282\u70B9"),P=s("\u96C6\u7FA4\u529F\u80FD\u68C0\u67E5"),q=s("\u96C6\u7FA4\u7F29\u5BB9"),H=u(`<h2 id="\u90E8\u7F72\u8BFB\u5199\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u8BFB\u5199\u8282\u70B9" aria-hidden="true">#</a> \u90E8\u7F72\u8BFB\u5199\u8282\u70B9</h2><p>\u9996\u5148\uFF0C\u5728\u5DF2\u7ECF\u642D\u5EFA\u5B8C\u6BD5\u7684\u5171\u4EAB\u5B58\u50A8\u96C6\u7FA4\u4E0A\uFF0C\u521D\u59CB\u5316\u5E76\u542F\u52A8\u7B2C\u4E00\u4E2A\u8BA1\u7B97\u8282\u70B9\uFF0C\u5373\u8BFB\u5199\u8282\u70B9\uFF0C\u8BE5\u8282\u70B9\u53EF\u4EE5\u5BF9\u5171\u4EAB\u5B58\u50A8\u8FDB\u884C\u8BFB\u5199\u3002\u6211\u4EEC\u5728\u4E0B\u9762\u7684\u955C\u50CF\u4E2D\u63D0\u4F9B\u4E86\u5DF2\u7ECF\u7F16\u8BD1\u5B8C\u6BD5\u7684 PolarDB for PostgreSQL \u5185\u6838\u548C\u5468\u8FB9\u5DE5\u5177\u7684\u53EF\u6267\u884C\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ <span class="token function">docker</span> pull polardb/polardb_pg_binary:pfs
$ <span class="token function">docker</span> run -it <span class="token punctuation">\\</span>
    --cap-add<span class="token operator">=</span>SYS_PTRACE <span class="token punctuation">\\</span>
    --privileged<span class="token operator">=</span>true <span class="token punctuation">\\</span>
    --name polardb_pg <span class="token punctuation">\\</span>
    --shm-size<span class="token operator">=</span>512m <span class="token punctuation">\\</span>
    polardb/polardb_pg_binary:pfs <span class="token punctuation">\\</span>
    <span class="token function">bash</span>

$ <span class="token function">ls</span> ~/tmp_basedir_polardb_pg_1100_bld/bin/
clusterdb     dropuser           pg_basebackup   pg_dump         pg_resetwal    pg_test_timing       polar-initdb.sh          psql
createdb      ecpg               pgbench         pg_dumpall      pg_restore     pg_upgrade           polar-replica-initdb.sh  reindexdb
createuser    initdb             pg_config       pg_isready      pg_rewind      pg_verify_checksums  polar_tools              vacuumdb
dbatools.sql  oid2name           pg_controldata  pg_receivewal   pg_standby     pg_waldump           postgres                 vacuumlo
dropdb        pg_archivecleanup  pg_ctl          pg_recvlogical  pg_test_fsync  polar_basebackup     postmaster
</code></pre></div><h3 id="\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE" tabindex="-1"><a class="header-anchor" href="#\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE" aria-hidden="true">#</a> \u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE</h3><p>\u4F7F\u7528 <code>lsblk</code> \u547D\u4EE4\u786E\u8BA4\u5B58\u50A8\u96C6\u7FA4\u5DF2\u7ECF\u80FD\u591F\u88AB\u5F53\u524D\u673A\u5668\u8BBF\u95EE\u5230\u3002\u6BD4\u5982\uFF0C\u5982\u4E0B\u793A\u4F8B\u4E2D\u7684 <code>nvme1n1</code> \u662F\u5C06\u8981\u4F7F\u7528\u7684\u5171\u4EAB\u5B58\u50A8\u7684\u5757\u8BBE\u5907\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1     <span class="token number">259</span>:0    <span class="token number">0</span>   40G  <span class="token number">0</span> disk
\u2514\u2500nvme0n1p1 <span class="token number">259</span>:1    <span class="token number">0</span>   40G  <span class="token number">0</span> part /etc/hosts
nvme1n1     <span class="token number">259</span>:2    <span class="token number">0</span>  100G  <span class="token number">0</span> disk
</code></pre></div><h3 id="\u683C\u5F0F\u5316\u5E76\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#\u683C\u5F0F\u5316\u5E76\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF" aria-hidden="true">#</a> \u683C\u5F0F\u5316\u5E76\u6302\u8F7D PFS \u6587\u4EF6\u7CFB\u7EDF</h3><p>\u6B64\u65F6\uFF0C\u5171\u4EAB\u5B58\u50A8\u4E0A\u6CA1\u6709\u4EFB\u4F55\u5185\u5BB9\u3002\u4F7F\u7528\u5BB9\u5668\u5185\u7684 PFS \u5DE5\u5177\u5C06\u5171\u4EAB\u5B58\u50A8\u683C\u5F0F\u5316\u4E3A PFS \u6587\u4EF6\u7CFB\u7EDF\u7684\u683C\u5F0F\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sudo</span> pfs -C disk <span class="token function">mkfs</span> nvme1n1
</code></pre></div><p>\u683C\u5F0F\u5316\u5B8C\u6210\u540E\uFF0C\u5728\u5F53\u524D\u5BB9\u5668\u5185\u542F\u52A8 PFS \u5B88\u62A4\u8FDB\u7A0B\uFF0C\u6302\u8F7D\u5230\u6587\u4EF6\u7CFB\u7EDF\u4E0A\u3002\u8BE5\u5B88\u62A4\u8FDB\u7A0B\u540E\u7EED\u5C06\u4F1A\u88AB\u8BA1\u7B97\u8282\u70B9\u7528\u4E8E\u8BBF\u95EE\u5171\u4EAB\u5B58\u50A8\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sudo</span> /usr/local/polarstore/pfsd/bin/start_pfsd.sh -p nvme1n1 -w <span class="token number">2</span>
</code></pre></div><h3 id="\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55" aria-hidden="true">#</a> \u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55</h3><p>\u4F7F\u7528 <code>initdb</code> \u5728\u8282\u70B9\u672C\u5730\u5B58\u50A8\u7684 <code>~/primary</code> \u8DEF\u5F84\u4E0A\u521B\u5EFA\u672C\u5730\u6570\u636E\u76EE\u5F55\u3002\u672C\u5730\u6570\u636E\u76EE\u5F55\u4E2D\u5C06\u4F1A\u5B58\u653E\u8282\u70B9\u7684\u914D\u7F6E\u3001\u5BA1\u8BA1\u65E5\u5FD7\u7B49\u8282\u70B9\u79C1\u6709\u7684\u4FE1\u606F\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/initdb -D <span class="token environment constant">$HOME</span>/primary
</code></pre></div><p>\u4F7F\u7528 PFS \u5DE5\u5177\uFF0C\u5728\u5171\u4EAB\u5B58\u50A8\u4E0A\u521B\u5EFA\u4E00\u4E2A\u5171\u4EAB\u6570\u636E\u76EE\u5F55\uFF1B\u4F7F\u7528 <code>polar-initdb.sh</code> \u811A\u672C\u628A\u5C06\u4F1A\u88AB\u6240\u6709\u8282\u70B9\u5171\u4EAB\u7684\u6570\u636E\u6587\u4EF6\u62F7\u8D1D\u5230\u5171\u4EAB\u5B58\u50A8\u7684\u6570\u636E\u76EE\u5F55\u4E2D\u3002\u5C06\u4F1A\u88AB\u6240\u6709\u8282\u70B9\u5171\u4EAB\u7684\u6587\u4EF6\u5305\u542B\u6240\u6709\u7684\u8868\u6587\u4EF6\u3001WAL \u65E5\u5FD7\u6587\u4EF6\u7B49\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sudo</span> pfs -C disk <span class="token function">mkdir</span> /nvme1n1/shared_data

<span class="token function">sudo</span> <span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/polar-initdb.sh <span class="token punctuation">\\</span>
    <span class="token environment constant">$HOME</span>/primary/ /nvme1n1/shared_data/
</code></pre></div><h3 id="\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u914D\u7F6E" aria-hidden="true">#</a> \u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u914D\u7F6E</h3><p>\u5BF9\u8BFB\u5199\u8282\u70B9\u7684\u914D\u7F6E\u6587\u4EF6 <code>~/primary/postgresql.conf</code> \u8FDB\u884C\u4FEE\u6539\uFF0C\u4F7F\u6570\u636E\u5E93\u4EE5\u5171\u4EAB\u6A21\u5F0F\u542F\u52A8\uFF0C\u5E76\u80FD\u591F\u627E\u5230\u5171\u4EAB\u5B58\u50A8\u4E0A\u7684\u6570\u636E\u76EE\u5F55\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">5432</span>
<span class="token key attr-name">polar_hostid</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>

<span class="token key attr-name">polar_enable_shared_storage_mode</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">polar_disk_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">nvme1n1</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">/nvme1n1/shared_data/</span>&#39;</span>
<span class="token key attr-name">polar_vfs.localfs_mode</span><span class="token punctuation">=</span><span class="token value attr-value">off</span>
<span class="token key attr-name">shared_preload_libraries</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">$libdir/polar_vfs,$libdir/polar_worker</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>

<span class="token key attr-name">logging_collector</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">log_line_prefix</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">%p\\t%r\\t%u\\t%m\\t</span>&#39;</span>
<span class="token key attr-name">log_directory</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">pg_log</span>&#39;</span>
<span class="token key attr-name">listen_addresses</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">*</span>&#39;</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">synchronous_standby_names</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">replica1</span>&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u7684\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u6587\u4EF6 <code>~/primary/pg_hba.conf</code>\uFF0C\u5141\u8BB8\u6765\u81EA\u6240\u6709\u5730\u5740\u7684\u5BA2\u6237\u7AEF\u4EE5 <code>postgres</code> \u7528\u6237\u8FDB\u884C\u7269\u7406\u590D\u5236\uFF1A</p><div class="language-text ext-text"><pre class="language-text"><code>host	replication	postgres	0.0.0.0/0	trust
</code></pre></div><h3 id="\u542F\u52A8\u8BFB\u5199\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u8BFB\u5199\u8282\u70B9" aria-hidden="true">#</a> \u542F\u52A8\u8BFB\u5199\u8282\u70B9</h3><p>\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u542F\u52A8\u8BFB\u5199\u8282\u70B9\uFF0C\u5E76\u68C0\u67E5\u8282\u70B9\u80FD\u5426\u6B63\u5E38\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl -D <span class="token environment constant">$HOME</span>/primary start

<span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&#39;SELECT version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h2 id="\u96C6\u7FA4\u6269\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u6269\u5BB9" aria-hidden="true">#</a> \u96C6\u7FA4\u6269\u5BB9</h2><p>\u63A5\u4E0B\u6765\uFF0C\u5728\u5DF2\u7ECF\u6709\u4E00\u4E2A\u8BFB\u5199\u8282\u70B9\u7684\u8BA1\u7B97\u96C6\u7FA4\u4E2D\u6269\u5BB9\u4E00\u4E2A\u65B0\u7684\u8BA1\u7B97\u8282\u70B9\u3002\u7531\u4E8E PolarDB for PostgreSQL \u662F\u4E00\u5199\u591A\u8BFB\u7684\u67B6\u6784\uFF0C\u6240\u4EE5\u540E\u7EED\u6269\u5BB9\u7684\u8282\u70B9\u53EA\u53EF\u4EE5\u5BF9\u5171\u4EAB\u5B58\u50A8\u8FDB\u884C\u8BFB\u53D6\uFF0C\u4F46\u65E0\u6CD5\u5BF9\u5171\u4EAB\u5B58\u50A8\u8FDB\u884C\u5199\u5165\u3002\u53EA\u8BFB\u8282\u70B9\u901A\u8FC7\u4E0E\u8BFB\u5199\u8282\u70B9\u8FDB\u884C\u7269\u7406\u590D\u5236\u6765\u4FDD\u6301\u5185\u5B58\u72B6\u6001\u7684\u540C\u6B65\u3002</p><p>\u7C7B\u4F3C\u5730\uFF0C\u5728\u7528\u4E8E\u90E8\u7F72\u65B0\u8BA1\u7B97\u8282\u70B9\u7684\u673A\u5668\u4E0A\uFF0C\u62C9\u53D6\u955C\u50CF\u5E76\u542F\u52A8\u5E26\u6709\u53EF\u6267\u884C\u6587\u4EF6\u7684\u5BB9\u5668\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> pull polardb/polardb_pg_binary:pfs
<span class="token function">docker</span> run -it <span class="token punctuation">\\</span>
    --cap-add<span class="token operator">=</span>SYS_PTRACE <span class="token punctuation">\\</span>
    --privileged<span class="token operator">=</span>true <span class="token punctuation">\\</span>
    --name polardb_pg <span class="token punctuation">\\</span>
    --shm-size<span class="token operator">=</span>512m <span class="token punctuation">\\</span>
    polardb/polardb_pg_binary:pfs <span class="token punctuation">\\</span>
    <span class="token function">bash</span>
</code></pre></div><h3 id="\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE-1" tabindex="-1"><a class="header-anchor" href="#\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE-1" aria-hidden="true">#</a> \u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE</h3><p>\u786E\u4FDD\u90E8\u7F72\u53EA\u8BFB\u8282\u70B9\u7684\u673A\u5668\u4E5F\u53EF\u4EE5\u8BBF\u95EE\u5230\u5171\u4EAB\u5B58\u50A8\u7684\u5757\u8BBE\u5907\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1     <span class="token number">259</span>:0    <span class="token number">0</span>   40G  <span class="token number">0</span> disk
\u2514\u2500nvme0n1p1 <span class="token number">259</span>:1    <span class="token number">0</span>   40G  <span class="token number">0</span> part /etc/hosts
nvme1n1     <span class="token number">259</span>:2    <span class="token number">0</span>  100G  <span class="token number">0</span> disk
</code></pre></div><h3 id="\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF" aria-hidden="true">#</a> \u6302\u8F7D PFS \u6587\u4EF6\u7CFB\u7EDF</h3><p>\u7531\u4E8E\u6B64\u65F6\u5171\u4EAB\u5B58\u50A8\u5DF2\u7ECF\u88AB\u8BFB\u5199\u8282\u70B9\u683C\u5F0F\u5316\u4E3A PFS \u683C\u5F0F\u4E86\uFF0C\u56E0\u6B64\u8FD9\u91CC\u65E0\u9700\u518D\u6B21\u8FDB\u884C\u683C\u5F0F\u5316\u3002\u53EA\u9700\u8981\u542F\u52A8 PFS \u5B88\u62A4\u8FDB\u7A0B\u5B8C\u6210\u6302\u8F7D\u5373\u53EF\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sudo</span> /usr/local/polarstore/pfsd/bin/start_pfsd.sh -p nvme1n1 -w <span class="token number">2</span>
</code></pre></div><h3 id="\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55-1" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55-1" aria-hidden="true">#</a> \u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55</h3><p>\u5728\u53EA\u8BFB\u8282\u70B9\u672C\u5730\u78C1\u76D8\u7684 <code>~/replica1</code> \u8DEF\u5F84\u4E0A\u521B\u5EFA\u4E00\u4E2A\u7A7A\u76EE\u5F55\uFF0C\u7136\u540E\u901A\u8FC7 <code>polar-replica-initdb.sh</code> \u811A\u672C\u4F7F\u7528\u5171\u4EAB\u5B58\u50A8\u4E0A\u7684\u6570\u636E\u76EE\u5F55\u6765\u521D\u59CB\u5316\u53EA\u8BFB\u8282\u70B9\u7684\u672C\u5730\u76EE\u5F55\u3002\u521D\u59CB\u5316\u540E\u7684\u672C\u5730\u76EE\u5F55\u4E2D\u6CA1\u6709\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\uFF0C\u6240\u4EE5\u8FD8\u9700\u8981\u4F7F\u7528 <code>initdb</code> \u521B\u5EFA\u4E00\u4E2A\u4E34\u65F6\u7684\u672C\u5730\u76EE\u5F55\u6A21\u677F\uFF0C\u7136\u540E\u5C06\u6240\u6709\u7684\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\u62F7\u8D1D\u5230\u53EA\u8BFB\u8282\u70B9\u7684\u672C\u5730\u76EE\u5F55\u4E0B\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">mkdir</span> -m 0700 <span class="token environment constant">$HOME</span>/replica1
<span class="token function">sudo</span> ~/tmp_basedir_polardb_pg_1100_bld/bin/polar-replica-initdb.sh <span class="token punctuation">\\</span>
    /nvme1n1/shared_data/ <span class="token environment constant">$HOME</span>/replica1/

<span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/initdb -D /tmp/replica1
<span class="token function">cp</span> /tmp/replica1/*.conf <span class="token environment constant">$HOME</span>/replica1/
</code></pre></div><h3 id="\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u914D\u7F6E" aria-hidden="true">#</a> \u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u914D\u7F6E</h3><p>\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u7684\u914D\u7F6E\u6587\u4EF6 <code>~/replica1/postgresql.conf</code>\uFF0C\u914D\u7F6E\u597D\u53EA\u8BFB\u8282\u70B9\u7684\u96C6\u7FA4\u6807\u8BC6\u548C\u76D1\u542C\u7AEF\u53E3\uFF0C\u4EE5\u53CA\u4E0E\u8BFB\u5199\u8282\u70B9\u76F8\u540C\u7684\u5171\u4EAB\u5B58\u50A8\u76EE\u5F55\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">5432</span>
<span class="token key attr-name">polar_hostid</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>

<span class="token key attr-name">polar_enable_shared_storage_mode</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">polar_disk_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">nvme1n1</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">/nvme1n1/shared_data/</span>&#39;</span>
<span class="token key attr-name">polar_vfs.localfs_mode</span><span class="token punctuation">=</span><span class="token value attr-value">off</span>
<span class="token key attr-name">shared_preload_libraries</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">$libdir/polar_vfs,$libdir/polar_worker</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>

<span class="token key attr-name">logging_collector</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">log_line_prefix</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">%p\\t%r\\t%u\\t%m\\t</span>&#39;</span>
<span class="token key attr-name">log_directory</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">pg_log</span>&#39;</span>
<span class="token key attr-name">listen_addresses</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">*</span>&#39;</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u7684\u590D\u5236\u914D\u7F6E\u6587\u4EF6 <code>~/replica1/recovery.conf</code>\uFF0C\u914D\u7F6E\u597D\u5F53\u524D\u8282\u70B9\u7684\u89D2\u8272\uFF08\u53EA\u8BFB\uFF09\uFF0C\u4EE5\u53CA\u4ECE\u8BFB\u5199\u8282\u70B9\u8FDB\u884C\u7269\u7406\u590D\u5236\u7684\u8FDE\u63A5\u4E32\u548C\u590D\u5236\u69FD\uFF1A</p><div class="language-ini ext-ini"><pre class="language-ini"><code><span class="token key attr-name">polar_replica</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">on</span>&#39;</span>
<span class="token key attr-name">recovery_target_timeline</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">latest</span>&#39;</span>
<span class="token key attr-name">primary_conninfo</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">host=[\u8BFB\u5199\u8282\u70B9\u6240\u5728IP] port=5432 user=postgres dbname=postgres application_name=replica1</span>&#39;</span>
<span class="token key attr-name">primary_slot_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">replica1</span>&#39;</span>
</code></pre></div><p>\u7531\u4E8E\u8BFB\u5199\u8282\u70B9\u4E0A\u6682\u65F6\u8FD8\u6CA1\u6709\u540D\u4E3A <code>replica1</code> \u7684\u590D\u5236\u69FD\uFF0C\u6240\u4EE5\u9700\u8981\u8FDE\u63A5\u5230\u8BFB\u5199\u8282\u70B9\u4E0A\uFF0C\u521B\u5EFA\u8FD9\u4E2A\u590D\u5236\u69FD\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT pg_create_physical_replication_slot(&#39;replica1&#39;);&quot;</span>
 pg_create_physical_replication_slot
-------------------------------------
 <span class="token punctuation">(</span>replica1,<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h3 id="\u542F\u52A8\u53EA\u8BFB\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u53EA\u8BFB\u8282\u70B9" aria-hidden="true">#</a> \u542F\u52A8\u53EA\u8BFB\u8282\u70B9</h3><p>\u5B8C\u6210\u4E0A\u8FF0\u6B65\u9AA4\u540E\uFF0C\u542F\u52A8\u53EA\u8BFB\u8282\u70B9\u5E76\u9A8C\u8BC1\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl -D <span class="token environment constant">$HOME</span>/replica1 start

<span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&#39;SELECT version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h3 id="\u96C6\u7FA4\u529F\u80FD\u68C0\u67E5" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u529F\u80FD\u68C0\u67E5" aria-hidden="true">#</a> \u96C6\u7FA4\u529F\u80FD\u68C0\u67E5</h3><p>\u8FDE\u63A5\u5230\u8BFB\u5199\u8282\u70B9\u4E0A\uFF0C\u521B\u5EFA\u4E00\u4E2A\u8868\u5E76\u63D2\u5165\u6570\u636E\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql -q <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;CREATE TABLE t(id INT); INSERT INTO t SELECT generate_series(1,10);&quot;</span>
</code></pre></div><p>\u5728\u53EA\u8BFB\u8282\u70B9\u4E0A\u53EF\u4EE5\u7ACB\u523B\u67E5\u8BE2\u5230\u4ECE\u8BFB\u5199\u8282\u70B9\u4E0A\u63D2\u5165\u7684\u6570\u636E\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql -q <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT * FROM t;&quot;</span>
 <span class="token function">id</span>
----
  <span class="token number">1</span>
  <span class="token number">2</span>
  <span class="token number">3</span>
  <span class="token number">4</span>
  <span class="token number">5</span>
  <span class="token number">6</span>
  <span class="token number">7</span>
  <span class="token number">8</span>
  <span class="token number">9</span>
 <span class="token number">10</span>
<span class="token punctuation">(</span><span class="token number">10</span> rows<span class="token punctuation">)</span>
</code></pre></div><p>\u4ECE\u8BFB\u5199\u8282\u70B9\u4E0A\u53EF\u4EE5\u770B\u5230\u7528\u4E8E\u4E0E\u53EA\u8BFB\u8282\u70B9\u8FDB\u884C\u7269\u7406\u590D\u5236\u7684\u590D\u5236\u69FD\u5DF2\u7ECF\u5904\u4E8E\u6D3B\u8DC3\u72B6\u6001\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql -q <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT * FROM pg_replication_slots;&quot;</span>
 slot_name <span class="token operator">|</span> plugin <span class="token operator">|</span> slot_type <span class="token operator">|</span> datoid <span class="token operator">|</span> database <span class="token operator">|</span> temporary <span class="token operator">|</span> active <span class="token operator">|</span> active_pid <span class="token operator">|</span> xmin <span class="token operator">|</span> catalog_xmin <span class="token operator">|</span> restart_lsn <span class="token operator">|</span> confirmed_flush_lsn
-----------+--------+-----------+--------+----------+-----------+--------+------------+------+--------------+-------------+---------------------
 replica1  <span class="token operator">|</span>        <span class="token operator">|</span> physical  <span class="token operator">|</span>        <span class="token operator">|</span>          <span class="token operator">|</span> f         <span class="token operator">|</span> t      <span class="token operator">|</span>         <span class="token number">45</span> <span class="token operator">|</span>      <span class="token operator">|</span>              <span class="token operator">|</span> <span class="token number">0</span>/4079E8E8  <span class="token operator">|</span>
<span class="token punctuation">(</span><span class="token number">1</span> rows<span class="token punctuation">)</span>
</code></pre></div><p>\u4F9D\u6B21\u7C7B\u63A8\uFF0C\u4F7F\u7528\u7C7B\u4F3C\u7684\u65B9\u6CD5\u8FD8\u53EF\u4EE5\u6A2A\u5411\u6269\u5BB9\u66F4\u591A\u7684\u53EA\u8BFB\u8282\u70B9\u3002</p><h2 id="\u96C6\u7FA4\u7F29\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u7F29\u5BB9" aria-hidden="true">#</a> \u96C6\u7FA4\u7F29\u5BB9</h2><p>\u96C6\u7FA4\u7F29\u5BB9\u7684\u6B65\u9AA4\u8F83\u4E3A\u7B80\u5355\uFF1A\u5C06\u53EA\u8BFB\u8282\u70B9\u505C\u673A\u5373\u53EF\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl -D <span class="token environment constant">$HOME</span>/replica1 stop
</code></pre></div><p>\u5728\u53EA\u8BFB\u8282\u70B9\u505C\u673A\u540E\uFF0C\u8BFB\u5199\u8282\u70B9\u4E0A\u7684\u590D\u5236\u69FD\u5C06\u53D8\u4E3A\u975E\u6D3B\u8DC3\u72B6\u6001\u3002\u975E\u6D3B\u8DC3\u7684\u590D\u5236\u69FD\u5C06\u4F1A\u963B\u6B62 WAL \u65E5\u5FD7\u7684\u56DE\u6536\uFF0C\u6240\u4EE5\u9700\u8981\u53CA\u65F6\u6E05\u7406\u3002</p><p>\u5728\u8BFB\u5199\u8282\u70B9\u4E0A\u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u79FB\u9664\u540D\u4E3A <code>replica1</code> \u7684\u590D\u5236\u69FD\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT pg_drop_replication_slot(&#39;replica1&#39;);&quot;</span>
 pg_drop_replication_slot
--------------------------

<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div>`,61);function T(o,L){const l=p("ArticleInfo"),e=p("router-link");return r(),i("div",null,[k,a(l,{frontmatter:o.$frontmatter},null,8,["frontmatter"]),_,n("nav",v,[n("ul",null,[n("li",null,[a(e,{to:"#\u90E8\u7F72\u8BFB\u5199\u8282\u70B9"},{default:t(()=>[b]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE"},{default:t(()=>[m]),_:1})]),n("li",null,[a(e,{to:"#\u683C\u5F0F\u5316\u5E76\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF"},{default:t(()=>[h]),_:1})]),n("li",null,[a(e,{to:"#\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55"},{default:t(()=>[g]),_:1})]),n("li",null,[a(e,{to:"#\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u914D\u7F6E"},{default:t(()=>[f]),_:1})]),n("li",null,[a(e,{to:"#\u542F\u52A8\u8BFB\u5199\u8282\u70B9"},{default:t(()=>[y]),_:1})])])]),n("li",null,[a(e,{to:"#\u96C6\u7FA4\u6269\u5BB9"},{default:t(()=>[x]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#\u786E\u8BA4\u5B58\u50A8\u53EF\u8BBF\u95EE-1"},{default:t(()=>[E]),_:1})]),n("li",null,[a(e,{to:"#\u6302\u8F7D-pfs-\u6587\u4EF6\u7CFB\u7EDF"},{default:t(()=>[M]),_:1})]),n("li",null,[a(e,{to:"#\u521D\u59CB\u5316\u6570\u636E\u76EE\u5F55-1"},{default:t(()=>[O]),_:1})]),n("li",null,[a(e,{to:"#\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u914D\u7F6E"},{default:t(()=>[$]),_:1})]),n("li",null,[a(e,{to:"#\u542F\u52A8\u53EA\u8BFB\u8282\u70B9"},{default:t(()=>[S]),_:1})]),n("li",null,[a(e,{to:"#\u96C6\u7FA4\u529F\u80FD\u68C0\u67E5"},{default:t(()=>[P]),_:1})])])]),n("li",null,[a(e,{to:"#\u96C6\u7FA4\u7F29\u5BB9"},{default:t(()=>[q]),_:1})])])]),H])}var N=c(d,[["render",T],["__file","scale-out.html.vue"]]);export{N as default};
