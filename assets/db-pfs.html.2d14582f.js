import{_ as r,o as i,c as u,b as a,a as n,w as e,d as s,e as d,r as o}from"./app.9dd76cc4.js";const k={},v=n("h1",{id:"\u57FA\u4E8E-pfs-\u6587\u4EF6\u7CFB\u7EDF\u90E8\u7F72",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u57FA\u4E8E-pfs-\u6587\u4EF6\u7CFB\u7EDF\u90E8\u7F72","aria-hidden":"true"},"#"),s(" \u57FA\u4E8E PFS \u6587\u4EF6\u7CFB\u7EDF\u90E8\u7F72")],-1),_=n("p",null,"\u672C\u6587\u5C06\u6307\u5BFC\u60A8\u5728\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF PolarDB File System\uFF08PFS\uFF09\u4E0A\u7F16\u8BD1\u90E8\u7F72 PolarDB\uFF0C\u9002\u7528\u4E8E\u5DF2\u7ECF\u5728\u5171\u4EAB\u5B58\u50A8\u4E0A\u683C\u5F0F\u5316\u5E76\u6302\u8F7D PFS \u6587\u4EF6\u7CFB\u7EDF\u7684\u8BA1\u7B97\u8282\u70B9\u3002",-1),m={class:"table-of-contents"},b=s("\u8BFB\u5199\u8282\u70B9\u90E8\u7F72"),g=s("\u53EA\u8BFB\u8282\u70B9\u90E8\u7F72"),h=s("\u96C6\u7FA4\u68C0\u67E5\u548C\u6D4B\u8BD5"),f=s("\u5E38\u89C1\u8FD0\u7EF4\u6B65\u9AA4"),y=d(`<h2 id="\u8BFB\u5199\u8282\u70B9\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u8BFB\u5199\u8282\u70B9\u90E8\u7F72" aria-hidden="true">#</a> \u8BFB\u5199\u8282\u70B9\u90E8\u7F72</h2><p>\u521D\u59CB\u5316\u8BFB\u5199\u8282\u70B9\u7684\u672C\u5730\u6570\u636E\u76EE\u5F55 <code>~/primary/</code>\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/initdb -D <span class="token environment constant">$HOME</span>/primary
</code></pre></div><p>\u5728\u5171\u4EAB\u5B58\u50A8\u7684 <code>/nvme1n1/shared_data/</code> \u8DEF\u5F84\u4E0A\u521B\u5EFA\u5171\u4EAB\u6570\u636E\u76EE\u5F55\uFF0C\u7136\u540E\u4F7F\u7528 <code>polar-initdb.sh</code> \u811A\u672C\u521D\u59CB\u5316\u5171\u4EAB\u6570\u636E\u76EE\u5F55\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u4F7F\u7528 pfs \u521B\u5EFA\u5171\u4EAB\u6570\u636E\u76EE\u5F55</span>
<span class="token function">sudo</span> pfs -C disk <span class="token function">mkdir</span> /nvme1n1/shared_data
<span class="token comment"># \u521D\u59CB\u5316 db \u7684\u672C\u5730\u548C\u5171\u4EAB\u6570\u636E\u76EE\u5F55</span>
<span class="token function">sudo</span> <span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/polar-initdb.sh <span class="token punctuation">\\</span>
    <span class="token environment constant">$HOME</span>/primary/ /nvme1n1/shared_data/
</code></pre></div><p>\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u7684\u914D\u7F6E\u3002\u6253\u5F00 <code>~/primary/postgresql.conf</code>\uFF0C\u589E\u52A0\u914D\u7F6E\u9879\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">5432</span>
<span class="token key attr-name">polar_hostid</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">polar_enable_shared_storage_mode</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">polar_disk_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">nvme1n1</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">/nvme1n1/shared_data/</span>&#39;</span>
<span class="token key attr-name">polar_vfs.localfs_mode</span><span class="token punctuation">=</span><span class="token value attr-value">off</span>
<span class="token key attr-name">shared_preload_libraries</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">$libdir/polar_vfs,$libdir/polar_worker</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>
<span class="token key attr-name">logging_collector</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">log_line_prefix</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">%p\\t%r\\t%u\\t%m\\t</span>&#39;</span>
<span class="token key attr-name">log_directory</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">pg_log</span>&#39;</span>
<span class="token key attr-name">listen_addresses</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">*</span>&#39;</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">synchronous_standby_names</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">replica1</span>&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7F16\u8F91\u8BFB\u5199\u8282\u70B9\u7684\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u6587\u4EF6 <code>~/primary/pg_hba.conf</code>\uFF0C\u589E\u52A0\u4EE5\u4E0B\u914D\u7F6E\u9879\uFF0C\u5141\u8BB8\u53EA\u8BFB\u8282\u70B9\u8FDB\u884C\u7269\u7406\u590D\u5236\uFF1A</p><div class="language-ini ext-ini"><pre class="language-ini"><code>host	replication	postgres	0.0.0.0/0	trust
</code></pre></div><p>\u6700\u540E\uFF0C\u542F\u52A8\u8BFB\u5199\u8282\u70B9\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl start -D <span class="token environment constant">$HOME</span>/primary
</code></pre></div><p>\u68C0\u67E5\u8BFB\u5199\u8282\u70B9\u80FD\u5426\u6B63\u5E38\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&#39;SELECT version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><p>\u5728\u8BFB\u5199\u8282\u70B9\u4E0A\uFF0C\u4E3A\u5BF9\u5E94\u7684\u53EA\u8BFB\u8282\u70B9\u521B\u5EFA\u76F8\u5E94\u7684\u590D\u5236\u69FD\uFF0C\u7528\u4E8E\u53EA\u8BFB\u8282\u70B9\u7684\u7269\u7406\u590D\u5236\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT pg_create_physical_replication_slot(&#39;replica1&#39;);&quot;</span>
 pg_create_physical_replication_slot
-------------------------------------
 <span class="token punctuation">(</span>replica1,<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h2 id="\u53EA\u8BFB\u8282\u70B9\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u53EA\u8BFB\u8282\u70B9\u90E8\u7F72" aria-hidden="true">#</a> \u53EA\u8BFB\u8282\u70B9\u90E8\u7F72</h2><p>\u5728\u53EA\u8BFB\u8282\u70B9\u672C\u5730\u78C1\u76D8\u7684 <code>~/replica1</code> \u8DEF\u5F84\u4E0A\u521B\u5EFA\u4E00\u4E2A\u7A7A\u76EE\u5F55\uFF0C\u7136\u540E\u901A\u8FC7 <code>polar-replica-initdb.sh</code> \u811A\u672C\u4F7F\u7528\u5171\u4EAB\u5B58\u50A8\u4E0A\u7684\u6570\u636E\u76EE\u5F55\u6765\u521D\u59CB\u5316\u53EA\u8BFB\u8282\u70B9\u7684\u672C\u5730\u76EE\u5F55\u3002\u521D\u59CB\u5316\u540E\u7684\u672C\u5730\u76EE\u5F55\u4E2D\u6CA1\u6709\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\uFF0C\u6240\u4EE5\u8FD8\u9700\u8981\u4F7F\u7528 <code>initdb</code> \u521B\u5EFA\u4E00\u4E2A\u4E34\u65F6\u7684\u672C\u5730\u76EE\u5F55\u6A21\u677F\uFF0C\u7136\u540E\u5C06\u6240\u6709\u7684\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\u62F7\u8D1D\u5230\u53EA\u8BFB\u8282\u70B9\u7684\u672C\u5730\u76EE\u5F55\u4E0B\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">mkdir</span> -m 0700 <span class="token environment constant">$HOME</span>/replica1
<span class="token function">sudo</span> ~/tmp_basedir_polardb_pg_1100_bld/bin/polar-replica-initdb.sh <span class="token punctuation">\\</span>
    /nvme1n1/shared_data/ <span class="token environment constant">$HOME</span>/replica1/

<span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/initdb -D /tmp/replica1
<span class="token function">cp</span> /tmp/replica1/*.conf <span class="token environment constant">$HOME</span>/replica1/
</code></pre></div><p>\u7F16\u8F91\u53EA\u8BFB\u8282\u70B9\u7684\u914D\u7F6E\u3002\u6253\u5F00 <code>~/replica1/postgresql.conf</code>\uFF0C\u589E\u52A0\u914D\u7F6E\u9879\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">5433</span>
<span class="token key attr-name">polar_hostid</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
<span class="token key attr-name">polar_enable_shared_storage_mode</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">polar_disk_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">nvme1n1</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">/nvme1n1/shared_data/</span>&#39;</span>
<span class="token key attr-name">polar_vfs.localfs_mode</span><span class="token punctuation">=</span><span class="token value attr-value">off</span>
<span class="token key attr-name">shared_preload_libraries</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">$libdir/polar_vfs,$libdir/polar_worker</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>
<span class="token key attr-name">logging_collector</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">log_line_prefix</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">%p\\t%r\\t%u\\t%m\\t</span>&#39;</span>
<span class="token key attr-name">log_directory</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">pg_log</span>&#39;</span>
<span class="token key attr-name">listen_addresses</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">*</span>&#39;</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFA\u53EA\u8BFB\u8282\u70B9\u7684\u590D\u5236\u914D\u7F6E\u6587\u4EF6 <code>~/replica1/recovery.conf</code>\uFF0C\u589E\u52A0\u8BFB\u5199\u8282\u70B9\u7684\u8FDE\u63A5\u4FE1\u606F\uFF0C\u4EE5\u53CA\u590D\u5236\u69FD\u540D\u79F0\uFF1A</p><div class="language-ini ext-ini"><pre class="language-ini"><code><span class="token key attr-name">polar_replica</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">on</span>&#39;</span>
<span class="token key attr-name">recovery_target_timeline</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">latest</span>&#39;</span>
<span class="token key attr-name">primary_slot_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">replica1</span>&#39;</span>
<span class="token key attr-name">primary_conninfo</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">host=[\u8BFB\u5199\u8282\u70B9\u6240\u5728IP] port=5432 user=postgres dbname=postgres application_name=replica1</span>&#39;</span>
</code></pre></div><p>\u6700\u540E\uFF0C\u542F\u52A8\u53EA\u8BFB\u8282\u70B9\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl start -D <span class="token environment constant">$HOME</span>/replica1
</code></pre></div><p>\u68C0\u67E5\u53EA\u8BFB\u8282\u70B9\u80FD\u5426\u6B63\u5E38\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\\</span>
    -p <span class="token number">5433</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&#39;SELECT version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h2 id="\u96C6\u7FA4\u68C0\u67E5\u548C\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u68C0\u67E5\u548C\u6D4B\u8BD5" aria-hidden="true">#</a> \u96C6\u7FA4\u68C0\u67E5\u548C\u6D4B\u8BD5</h2><p>\u90E8\u7F72\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u8FDB\u884C\u5B9E\u4F8B\u68C0\u67E5\u548C\u6D4B\u8BD5\uFF0C\u786E\u4FDD\u8BFB\u5199\u8282\u70B9\u53EF\u6B63\u5E38\u5199\u5165\u6570\u636E\u3001\u53EA\u8BFB\u8282\u70B9\u53EF\u4EE5\u6B63\u5E38\u8BFB\u53D6\u3002</p><p>\u767B\u5F55 <strong>\u8BFB\u5199\u8282\u70B9</strong>\uFF0C\u521B\u5EFA\u6D4B\u8BD5\u8868\u5E76\u63D2\u5165\u6837\u4F8B\u6570\u636E\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql -q <span class="token punctuation">\\</span>
    -p <span class="token number">5432</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;CREATE TABLE t (t1 INT PRIMARY KEY, t2 INT); INSERT INTO t VALUES (1, 1),(2, 3),(3, 3);&quot;</span>
</code></pre></div><p>\u767B\u5F55 <strong>\u53EA\u8BFB\u8282\u70B9</strong>\uFF0C\u67E5\u8BE2\u521A\u521A\u63D2\u5165\u7684\u6837\u4F8B\u6570\u636E\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql -q <span class="token punctuation">\\</span>
    -p <span class="token number">5433</span> <span class="token punctuation">\\</span>
    -d postgres <span class="token punctuation">\\</span>
    -c <span class="token string">&quot;SELECT * FROM t;&quot;</span>
 t1 <span class="token operator">|</span> t2
----+----
  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">1</span>
  <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span>
  <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">3</span>
<span class="token punctuation">(</span><span class="token number">3</span> rows<span class="token punctuation">)</span>
</code></pre></div><p>\u5728\u8BFB\u5199\u8282\u70B9\u4E0A\u63D2\u5165\u7684\u6570\u636E\u5BF9\u53EA\u8BFB\u8282\u70B9\u53EF\u89C1\uFF0C\u8FD9\u610F\u5473\u7740\u57FA\u4E8E\u5171\u4EAB\u5B58\u50A8\u7684 PolarDB \u8BA1\u7B97\u8282\u70B9\u96C6\u7FA4\u642D\u5EFA\u6210\u529F\u3002</p><hr><h2 id="\u5E38\u89C1\u8FD0\u7EF4\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#\u5E38\u89C1\u8FD0\u7EF4\u6B65\u9AA4" aria-hidden="true">#</a> \u5E38\u89C1\u8FD0\u7EF4\u6B65\u9AA4</h2>`,35),E=s("\u5907\u4EFD\u6062\u590D"),x=s("\u5171\u4EAB\u5B58\u50A8\u5728\u7EBF\u6269\u5BB9"),$=s("\u8BA1\u7B97\u8282\u70B9\u6269\u7F29\u5BB9"),O=s("\u53EA\u8BFB\u8282\u70B9\u5728\u7EBF Promote");function M(l,H){const c=o("ArticleInfo"),t=o("router-link"),p=o("RouterLink");return i(),u("div",null,[v,a(c,{frontmatter:l.$frontmatter},null,8,["frontmatter"]),_,n("nav",m,[n("ul",null,[n("li",null,[a(t,{to:"#\u8BFB\u5199\u8282\u70B9\u90E8\u7F72"},{default:e(()=>[b]),_:1})]),n("li",null,[a(t,{to:"#\u53EA\u8BFB\u8282\u70B9\u90E8\u7F72"},{default:e(()=>[g]),_:1})]),n("li",null,[a(t,{to:"#\u96C6\u7FA4\u68C0\u67E5\u548C\u6D4B\u8BD5"},{default:e(()=>[h]),_:1})]),n("li",null,[a(t,{to:"#\u5E38\u89C1\u8FD0\u7EF4\u6B65\u9AA4"},{default:e(()=>[f]),_:1})])])]),y,n("ul",null,[n("li",null,[a(p,{to:"/operation/backup-and-restore.html"},{default:e(()=>[E]),_:1})]),n("li",null,[a(p,{to:"/operation/grow-storage.html"},{default:e(()=>[x]),_:1})]),n("li",null,[a(p,{to:"/operation/scale-out.html"},{default:e(()=>[$]),_:1})]),n("li",null,[a(p,{to:"/operation/ro-online-promote.html"},{default:e(()=>[O]),_:1})])])])}var P=r(k,[["render",M],["__file","db-pfs.html.vue"]]);export{P as default};
